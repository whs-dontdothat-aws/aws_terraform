import json
import os
import requests

DISCORD_WEBHOOK_URL = os.environ.get("DISCORD_WEBHOOK_URL")

def lambda_handler(event, context):
    ip = event.get("ip", "N/A")
    abuse_score = event.get("abuse_score", "N/A")
    isp = event.get("isp", "N/A")
    country = event.get("countryCode", "N/A")
    domain = event.get("domain", "N/A")
    total_reports = event.get("total_reports", "N/A")
    is_hosting = event.get("is_hosting", False)
    usage_type = event.get("usage_type", "N/A")

    embed = {
        "title": "ğŸš¨ ì°¨ë‹¨ëœ IP ê°ì§€ ë° ìë™ ëŒ€ì‘",
        "color": 15158332,
        "fields": [
            {"name": "ê³µê²© IP", "value": ip, "inline": True},
            {"name": "êµ­ê°€", "value": country, "inline": True},
            {"name": "ISP", "value": isp, "inline": True},
            {"name": "í˜¸ìŠ¤íŒ… ì—¬ë¶€", "value": str(is_hosting), "inline": True},
            {"name": "Abuse Score", "value": str(abuse_score), "inline": True},
            {"name": "ì´ ì‹ ê³  ìˆ˜", "value": str(total_reports), "inline": True},
            {"name": "Usage Type", "value": usage_type, "inline": True},
            {"name": "ë„ë©”ì¸", "value": domain, "inline": True}
        ],
        "footer": {"text": "AWS WAF ìë™ ëŒ€ì‘ ì‹œìŠ¤í…œ"}
    }

    data = { "embeds": [embed] }

    try:
        res = requests.post(DISCORD_WEBHOOK_URL, json=data)
        res.raise_for_status()
        return {"statusCode": 200, "body": "Notification sent"}
    except Exception as e:
        return {"statusCode": 500, "body": str(e)}